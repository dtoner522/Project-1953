<div class="fafafa">
  <div class="nav-top d-flex justify-content-between align-items-center px-4 pt-4">
    <%= link_to root_path do  %>
      <%= image_tag "1953.png", class: "", style:"height:20px"%>
    <% end %>
    <h1>Explore</h1>
  </div>

  <div class="container messages-container pt-3 pb-5">
    <%= form_tag(library_books_path, method: :get) do %>
      <div class="mb-3 width multi-search-form w-100">
      <%= text_field_tag :title,
            params[:title],
            class: "form-control white-bar b-sh text-center", placeholder: "type title, author...",
            onfocus: "this.placeholder, ''", onblur: "this.placeholder, 'type title, author...'"
          %>
      </div>
      <div class="d-flex justify-content-between align-items-center mb-3">
        <%=  select_tag :language, options_for_select([["English", "en"], ["French", "fr"], ["Spanish", "es"]],
                        selected: params["language"]), include_blank: "Language", class: "border-green select2 m-0",
                        id: "language-select" %>
        <%=  select_tag :genre, options_for_select(["Fiction", "Non-Fiction", "Poetry", "Drama", "Science-Fiction"],
                        selected: params["genre"]),  include_blank: "Genre", class: "border-green select2",
                        id: "genre-select"  %>
        <%= button_tag(class: "btn icon-primary") do %>
            <i class="fas fa-search"></i>
        <% end %>

    <% end %>
  </div>

  <% if @library_books.empty? %>
    <div class="text-center">
      <%= cl_image_tag("https://res.cloudinary.com/dfgdbji11/image/upload/v1616376980/reading-corner-colour_ak0ida.svg", class: "not-found") %>
      <h1 class="mt-3">No results  found.</h1>
      <p>Please check your entry for spelling errors or try a different keyword.</p>
      <%= link_to "Go back", root_path, class: "btn btn-green text-white" %>
    </div>

  <% else %>

    <% @library_books.each do |lib_book| %>

      <div class="book-results-card d-flex b-sh mb-3">
        <div class="image" style="background-image: url('<%= cl_image_path lib_book.book.photo.key %>')"></div>
        <div class="information p-3">
          <%= link_to library_book_path(lib_book) do %>
            <h2><%= lib_book.book.title %></h2>
          <% end %>

          <p><%= lib_book.book.author %></p>

          <div class="user-owner d-flex">
            <%= cl_image_tag lib_book.library.user.photo.key, class: "avatar-20 mr-2", alt: "avatar" %>

            <%= link_to user_path(lib_book.library.user), class: "text-decoration" do %>
            <p class="name"> <%= lib_book.library.user.first_name.capitalize %>
            <% end %>
      
               <span class="span-location" style="font-style: italic; color: gray; font-weight: 300"> <%= lib_book.library.user.location %>
              </span></p>
          
          </div>

          <div class="tags d-flex">
              <%= link_to lib_book.book.genre , library_books_path("?genre=#{lib_book.book.genre}"), class: "btn genre mr-2" %>
          </div>

           <%# here's a comment %>
          <% if user_signed_in? %>

            <!-- if Book is not in User's library -> show add/remove Wishlist-->
            <% if !current_user.libraries.first.books.include?(lib_book.book) %>

              <!-- if Book is  in User's Wishlist -->
              <% if @wishlist_books.include?(lib_book.book) %>
                <%= link_to delete_wishlist_book_path(lib_book.is_in_wishlist(lib_book, current_user)), method: :delete, class: "heart btn-transparent" do %>
                  <i class='fas fa-heart'></i>
                <% end %>

              <!-- if Book is not in User's Wishlist -->
              <% else %>
                <%= simple_form_for(@wishlist_book) do |f| %>
                  <%= hidden_field_tag "book_id", lib_book.book.id %>
                  <%= hidden_field_tag "wishlist_id", current_user.wishlists.first.id %>
                  <div style="height: 0">
                    <%= button_tag(class: "heart btn-transparent") do %>
                      <i class='fas fa-heart' style="color:white"></i>
                      <i class='far fa-heart'></i>
                    <% end %>
                  </div>
                <% end %>
              <% end %>

            <!-- if Book is in User's library -> show nothing -->
            <% end %>

          <% end %>


        </div>
      </div>

      <%= render 'library-book', lib_book: lib_book %>
 
  <% end %>
  <% end %>
</div>

<%= render 'shared/nav-bottom' %>
